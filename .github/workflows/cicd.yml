name: "QA Automation Testing"

on:
  push:
    branches:
      - github_actions_yml
  pull_request:
    branches:
      - main

jobs:
    backend-regression-tests:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Set up Python
          uses: actions/setup-python@v4
          with:
            python-version: '3.13'

        - name: Install dependencies via requirements.txt
          run: pip install -r requirements.txt

        - name: Run Backend tests
          env:
            WOO_KEY: ${{ secrets.WOO_KEY }}
            WOO_SECRET: ${{ secrets.WOO_SECRET }}
            DB_USER: ${{ secrets.DB_USER }}
            DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
            PYTHONPATH: "${{ github.workspace }}/src"
          run : |
            echo "Setting up environment variables"
            source variables_local.env
            cd demostore_automation
            pytest tests/backend -v -s --html=reports/backend-regression.html