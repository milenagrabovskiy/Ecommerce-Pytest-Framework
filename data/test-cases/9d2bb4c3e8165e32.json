{"uid":"9d2bb4c3e8165e32","name":"test_apply_expired_coupon_neg","fullName":"tests.backend.coupons.test_apply_coupons#test_apply_expired_coupon_neg","historyId":"97a572918779b9751b68903cf8e77178","time":{"start":1757093860869,"stop":1757093861497,"duration":628},"description":"Verify that applying an expired coupon to an order fails.\n\nCreates an expired coupon, attempts to apply it to a new order,\nand checks that the API returns the correct error and that the coupon\nis recognized as invalid.\n\nArgs:\n    apply_coupon_setup (dict): Fixture with DAOs, API helpers, and test data.\n\nAsserts:\n    - Coupon is expired.\n    - API response matches expected error for expired coupons.\n","descriptionHtml":"<p>Verify that applying an expired coupon to an order fails.</p>\n<p>Creates an expired coupon, attempts to apply it to a new order,<br />\nand checks that the API returns the correct error and that the coupon<br />\nis recognized as invalid.</p>\n<p>Args:<br />\napply_coupon_setup (dict): Fixture with DAOs, API helpers, and test data.</p>\n<p>Asserts:<br />\n- Coupon is expired.<br />\n- API response matches expected error for expired coupons.</p>\n","status":"broken","statusMessage":"TypeError: 'dict' object cannot be interpreted as an integer","statusTrace":"apply_coupon_setup = {'coupon_ids': [35136], 'coupons_api_helper': <demostore_automation.src.api_helpers.CouponAPIHelper.CouponAPIHelper ob...src.dao.coupons_dao.CouponsDAO object at 0x7fbd9abcd940>, 'customer_email': 'betest_bwvamilkxgpyadq@supersqa.com', ...}\n\n    @pytest.mark.ebe12\n    def test_apply_expired_coupon_neg(apply_coupon_setup):\n        \"\"\"Verify that applying an expired coupon to an order fails.\n    \n        Creates an expired coupon, attempts to apply it to a new order,\n        and checks that the API returns the correct error and that the coupon\n        is recognized as invalid.\n    \n        Args:\n            apply_coupon_setup (dict): Fixture with DAOs, API helpers, and test data.\n    \n        Asserts:\n            - Coupon is expired.\n            - API response matches expected error for expired coupons.\n        \"\"\"\n        customer_id = apply_coupon_setup['customer_id']\n        product_id = apply_coupon_setup['product_id']\n    \n        # create expired coupon\n        expired_coupon = apply_coupon_setup[\"generic_coupons_helper\"].create_expired_coupon()\n        coupon_id = expired_coupon['id']\n        apply_coupon_setup[\"coupon_ids\"].append(coupon_id) # for teardown\n        coupon_code = expired_coupon['code']\n    \n        # create order with expired coupon\n>       create_order = apply_coupon_setup[\"generic_orders_helper\"].create_order_for_customer(customer_id, product_id)\n\ntests/backend/coupons/test_apply_coupons.py:178: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nsrc/generic_helpers/generic_orders_helper.py:121: in create_order_for_customer\n    return self.create_order(product_args)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <demostore_automation.src.generic_helpers.generic_orders_helper.GenericOrdersHelper object at 0x7fbd9abce270>\norder_qty = {'customer_id': 2710, 'line_items': [{'product_id': 20, 'quantity': 1}], 'shipping_lines': [{'method_id': 'free_shipping', 'method_title': 'Free Shipping', 'total': '0.00'}]}\nproduct_qty = 1, additional_args = None\n\n    def create_order(self, order_qty=1, product_qty=1, additional_args=None):\n        \"\"\"Create an order with optional custom arguments.\n    \n        Args:\n            additional_args (dict, optional): Fields to override or add to the order payload.\n            order_qty (int): Quantity of orders.\n            product_qty (int): Quantity of products.\n    \n        Returns:\n            dict: API response with the created order details.\n    \n        Raises:\n            TypeError: If `additional_args` is not a dict.\n            FileNotFoundError, IOError, PermissionError, UnicodeError: File read errors.\n        \"\"\"\n        # create full path regardless of os\n        payload_json_file = os.path.join(self.current_file_dir, '..', 'data', 'create_order_payload.json')\n    \n        try:\n            with open(payload_json_file, 'r') as f:\n                payload = json.load(f)\n    \n            if additional_args:\n                if not isinstance(additional_args, dict):\n                    raise TypeError(f\"File must be of type dict. Actual: {type(additional_args)}\")\n                payload.update(additional_args)\n    \n            if \"line_items\" not in payload:\n                random_product = self.products_dao.get_random_product_from_db(qty=1)\n                random_product_id = random_product[0]['ID']\n                payload[\"line_items\"] = [{\"product_id\": random_product_id, \"quantity\": product_qty}]\n    \n            else:\n                for i in payload[\"line_items\"]:\n                    i[\"quantity\"] = product_qty # if not line_items, payload will still take product_qty\n    \n    \n        except (FileNotFoundError, IOError, PermissionError, UnicodeError) as e:\n            logger.error(f\"Could not read payload file: {e}\")\n            raise\n    \n        create_order_responses = []\n>       for i in range(order_qty):\nE       TypeError: 'dict' object cannot be interpreted as an integer\n\nsrc/generic_helpers/generic_orders_helper.py:71: TypeError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"apply_coupon_setup","time":{"start":1757093859940,"stop":1757093860808,"duration":868},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"apply_coupon_setup::0","time":{"start":1757093861513,"stop":1757093861828,"duration":315},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"ebe12"},{"name":"tag","value":"applycoupon"},{"name":"parentSuite","value":"tests.backend.coupons"},{"name":"suite","value":"test_apply_coupons"},{"name":"host","value":"pkrvm7jw40e0xgp"},{"name":"thread","value":"2182-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.backend.coupons.test_apply_coupons"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":["ebe12","applycoupon"]},"source":"9d2bb4c3e8165e32.json","parameterValues":[]}